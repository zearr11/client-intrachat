<div class="message-wrapper" [class.me]="isMe()" [class.other]="!isMe()">
  <!-- Mostrar avatar solo si NO soy yo y es chat grupal -->
  @if (!isMe() && !isChatPrivate()) {
  <img class="avatar" [src]="dataMessage().remitente.urlFoto" alt="avatar" />
  }

  <div class="message-content">
    <!-- Mostrar nombre solo si NO soy yo y es chat grupal -->
    @if (!isMe() && !isChatPrivate()) {
    <span class="username">{{ dataMessage().remitente.nombreYApellido }}</span>
    }

    <!-- BURBUJA -->
    <div class="bubble">
      <!-- Switch por tipo de mensaje -->
      @switch (dataMessage().tipoMensaje) {

      <!-- TEXTO -->
      @case ('MSG_TEXTO') {
      <div class="text-message">
        {{ dataMessage().contenido }}
      </div>
      }

      <!-- IMAGEN -->
      @case ('MSG_IMAGEN') {
      <div class="image-message">
        <img [src]="dataMessage().archivoResponse?.url" alt="image" />
      </div>
      }

      <!-- ARCHIVO -->
      @case ('MSG_ARCHIVO') {
      <div class="file-message d-flex align-items-center">
        <i class="fa-solid fa-file-arrow-down file-icon"></i>

        <div class="file-info">
          <div class="file-name">
            {{ dataMessage().archivoResponse?.nombre }}
          </div>
          <div class="file-size">
            {{ dataMessage().archivoResponse?.tamanio }}
          </div>
        </div>

        <a
          class="download-btn"
          (click)="downloadFile(dataMessage().archivoResponse!)"
        >
          <i class="fa-solid fa-download"></i>
        </a>
      </div>
      } }
    </div>

    <!-- FECHA / HORA -->
    <div class="timestamp">
      {{ dataMessage().fechaEnvio | date : "shortTime" }}
    </div>
  </div>
</div>

<style>
  .message-wrapper {
    display: flex;
    gap: 10px;
    margin: 8px 0;
    max-width: 85%;
  }

  .message-wrapper.me {
    margin-left: auto;
    flex-direction: row-reverse;
  }

  .avatar {
    width: 38px;
    height: 38px;
    border-radius: 10px;
    object-fit: cover;
  }

  .message-content {
    display: flex;
    flex-direction: column;
    max-width: 100%;
  }

  .username {
    font-size: 0.75rem;
    font-weight: 600;
    margin-left: 4px;
    color: #d8d8d8;
  }

  .bubble {
    border-radius: 14px;
    padding: 10px 14px;
    max-width: 100%;
    word-wrap: break-word;
    position: relative;
  }

  /* Mi mensaje (derecha) */
  .message-wrapper.me .bubble {
    background: #0d6efd;
    color: white;
    border-bottom-right-radius: 4px;
  }

  /* Otros mensajes (izquierda) */
  .message-wrapper.other .bubble {
    background: #2b2b2b;
    color: #e9e9e9;
    border-bottom-left-radius: 4px;
  }

  /* TEXTO */
  .text-message {
    font-size: 0.95rem;
  }

  /* IMAGEN */
  .image-message img {
    max-width: 240px;
    border-radius: 12px;
    display: block;
  }

  /* ARCHIVO */
  .file-message {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .file-icon {
    font-size: 1.9rem;
    color: #ffc107;
  }

  .file-info .file-name {
    font-weight: 600;
    font-size: 0.9rem;
  }

  .file-info .file-size {
    font-size: 0.75rem;
    color: #bbb;
  }

  .download-btn i {
    font-size: 1.3rem;
    color: #fff;
    cursor: pointer;
    transition: 0.2s;
  }

  .download-btn i:hover {
    transform: scale(1.15);
  }

  .timestamp {
    font-size: 0.7rem;
    opacity: 0.55;
    margin-top: 3px;
    text-align: right;
  }
</style>
